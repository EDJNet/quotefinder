---
title: "getting_the_data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{getting_the_data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library("edjnetquotefinder")
library("rtweet")
library("dplyr")

twitter_token <- readRDS(file = "twitter_token.rds")
```

## Getting tweets by user

A possible approach is to extract a list of users from a list that a Twitter user has created on Twitter. 

The official account of the European Parliament has [a list with all MEPs who are on Twitter](https://twitter.com/Europarl_EN/lists/all-meps-on-twitter/members). This can be extracted with the following command:

```{r}

if (fs::file_exists("mep_df.rds")==FALSE) {
  mep_df <- rtweet::lists_members(slug = "all-meps-on-twitter",
                                  owner_user = "Europarl_EN",
                                  token = twitter_token)
  saveRDS(object = mep_df, file = "mep_df")
} else {
  mep_df <- readRDS(file = "mep_df.rds")
}


mep_df %>%
  arrange(desc(followers_count))
```

The following command will download all available tweets for the given users. If they have been previously downloaded, it will download only newer tweets. 

```{r getting_tweets}
qf_get_tweets_by_user(users = sample(mep_df$screen_name),
                      twitter_token = twitter_token,
                      wait = 2)

```


```{r eval = FALSE}

rtweet::rate_limit(token = twitter_token, query = "get_timeline")


getting_tweets <- callr::r_bg(func = qf_get_tweets_by_user,
                              args = list(users = mep_df$screen_name,
                                          twitter_token = twitter_token))
```

Tweets are stored in a subfolder, `tweets_by_user`. 

It is possible to load them in a single data frame with the following command, which facilitates also filtering by date. By default, the resulting data frame of tweets is stored in `tweets_all/tweets_all.rds`.

```{r saving_tweets}
tweets_all <- qf_bind_rows_tweets(users = mep_df$screen_name,
                                  since = Sys.Date()-31,
                                  save = TRUE)
```

```{r}
tweets_all %>% 
  filter(is_retweet==FALSE) %>% 
  saveRDS(file = fs::path("tweets_all", "tweets_all_no_rt.rds"))
```

<<<<<<< HEAD

```{r}
ep_parliament_lists <- lists_users(user = "europarl_en", reverse = TRUE, token = NULL, parse = TRUE)

slug = "all-meps-on-twitter"

```

=======
## Getting tweets from lists

```{r}
qf_get_tweets_from_list(slug = "all-meps-on-twitter",
                        owner_user = "europarl_en",
                        n = 3200,
                        include_rts = FALSE,
                        twitter_token = twitter_token)
```


>>>>>>> 192a1c133b1aad680a2fad95327c58ce1bbd5599
