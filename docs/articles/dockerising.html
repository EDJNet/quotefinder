<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deploy with Docker • quotefinder</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Deploy with Docker">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">quotefinder</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dockerising.html">Deploy with Docker</a>
    </li>
    <li>
      <a href="../articles/edjnetquotefinder.html">quotefinder</a>
    </li>
    <li>
      <a href="../articles/european_parliament.html">Getting information about Members of the European Parliament</a>
    </li>
    <li>
      <a href="../articles/retrieving_tweets.html">Retrieving tweets</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/edjnet/quotefinder">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Deploy with Docker</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/edjnet/quotefinder/blob/master/vignettes/dockerising.Rmd"><code>vignettes/dockerising.Rmd</code></a></small>
      <div class="hidden name"><code>dockerising.Rmd</code></div>

    </div>

    
    
<p>The easiest way to extract tweets regualarly and deploy a shiny app that facilitates exploring them is to use a server and run services with Docker.</p>
<p>In order to facilitate the process, <code>quotefinder</code> comes with dedicated and customisable Docker containers.</p>
<div id="getting-the-tweets" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-the-tweets" class="anchor"></a>Getting the tweets</h1>
<p>After having a server running, with Docker enabled, and having created a user with the rights to run docker containers, you should create a folder, called <code>qf_data</code>. At this stage, the folder should contain three files:</p>
<ol style="list-style-type: decimal">
<li><p>an R file, with the sole purpose of running a rmarkdown document. The full content of the file can be as follows <code><a href="https://rdrr.io/pkg/rmarkdown/man/render.html">rmarkdown::render(input = "/home/qf/qf_data/qf_get_tweets.Rmd")</a></code>. <a href="https://github.com/giocomai/quotefinder/blob/master/inst/qf_get_tweets/qf_data/qf_get_tweets.R">See example</a>.</p></li>
<li><p>an rmarkdown file (<a href="https://github.com/giocomai/quotefinder/blob/master/inst/qf_get_tweets/qf_data/qf_get_tweets.Rmd">see example</a>). It will likely be a basic document, which may just include a call to <code><a href="../reference/qf_get_tweets_from_list.html">qf_get_tweets_from_list()</a></code> or similar function.</p></li>
<li><p>a twitter token, stored e.g. as <code>twitter_token.rds</code>.</p></li>
</ol>
<p>An rmarkdown file is, of course, not stricly speaking necessary, but I find it makes it much easier to deal with issues such as folder locations, and allows to detail subsequent steps in an ordered fashion, no matter how complicated the procedure at hand. The R file can of course include calls to more than one rmarkdown files if this feels easier to manage. If useful, rmarkdown output files can be stored locally as a form of logging.</p>
</div>
<div id="dockerised-rstudio-with-pre-loaded-quotefinder" class="section level1">
<h1 class="hasAnchor">
<a href="#dockerised-rstudio-with-pre-loaded-quotefinder" class="anchor"></a>Dockerised Rstudio with pre-loaded <code>quotefinder</code>
</h1>
<p>In order to check if everything is in order, you may want to have a look at your server in an interactive R session.</p>
<p>Run this command if you prefer to keep files in your user directory on the server.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="fu">mkdir</span> qf_data</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ex">docker</span> run --rm -p 28788:8787 -v <span class="va">$HOME</span>/qf_data:/home/qf/qf_data -e USER=qf -e PASSWORD=ies5EshaiPh6 --name qf_rstudio giocomai/qf_rstudio </a></code></pre></div>
<p>Or run this command to use Docker volumes</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="ex">docker</span> run --rm -p 28788:8787 -v qf_data:/home/qf/qf_data -e USER=qf -e PASSWORD=ies5EshaiPh6 --name qf_rstudio giocomai/qf_rstudio </a></code></pre></div>
<p>N.B. keep qf as the user, but do change password! <code>ies5EshaiPh6</code> is just a random string. You can change the port where to make available Rstudio by changing the first part of <code>28788:8787</code> in the command above (add <code>-d</code> if you want this rstudio session to continue running). The Dockerfile used to create this image <a href="https://github.com/giocomai/quotefinder/blob/master/inst/qf_rstudio/Dockerfile">is available on GitHub</a>.</p>
<p>You can then access the rstudio session using the ip (or the domain name) associated with your host, like <a href="http://123.123.123.123:28788" class="uri">http://123.123.123.123:28788</a></p>
<p>In order to get some example files, you can download them to the <code>qf_data</code> folder by running these data in the newly opened Rstudio session in your browser.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="dt">url =</span> <span class="st">"https://raw.githubusercontent.com/giocomai/quotefinder/master/inst/qf_get_tweets/qf_data/qf_get_tweets.R"</span>,</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">              <span class="dt">destfile =</span> <span class="st">"qf_data/qf_get_tweets.R"</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="dt">url =</span> <span class="st">"https://raw.githubusercontent.com/giocomai/quotefinder/master/inst/qf_get_tweets/qf_data/qf_get_tweets.Rmd"</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">              <span class="dt">destfile =</span> <span class="st">"qf_data/qf_get_tweets.Rmd"</span>)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="dt">url =</span> <span class="st">"https://raw.githubusercontent.com/giocomai/quotefinder/master/inst/qf_get_tweets/qf_data/qf_pre_process_tweets.Rmd"</span>,</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">                <span class="dt">destfile =</span> <span class="st">"qf_data/qf_pre_process_tweets.Rmd"</span>)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="dt">url =</span> <span class="st">"https://raw.githubusercontent.com/giocomai/quotefinder/master/inst/qf_get_tweets/qf_data/create_token.Rmd"</span>,</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">              <span class="dt">destfile =</span> <span class="st">"qf_data/create_token.Rmd"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/qf_get_tweets_from_list.html">qf_get_tweets_from_list</a></span>(<span class="dt">slug =</span> <span class="st">"current-meps"</span>,</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">                        <span class="dt">owner_user =</span> <span class="st">"EDJQuoteFinder"</span>,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                        <span class="dt">n =</span> <span class="dv">32</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                        <span class="dt">include_rts =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                        <span class="dt">twitter_token =</span> twitter_token)</a></code></pre></div>
<p>If you already have a twitter token, you can copy it to the <code>qf_data</code> subfolder as <code>twitter_token.rds</code>. If not, now it’s the right time to create one. You can do so by opening the <code>create_token.Rmd</code> file that you should find in the <code>qf_data</code> folder.</p>
<p>At this stage, you can customise the <code>qf_get_tweets.Rmd</code> to download the tweets you are interested in.</p>
<p>Running the command in <code>qf_get_tweets.R</code> should process the rmarkdown file and store tweets locally.</p>
<p>You can use this interface to customise scripts, and troubleshoot any issues. If everything looks fine, you can proceed to the next section: having tweets updated regularly.</p>
</div>
<div id="have-tweets-updated-regularly-with-cron" class="section level1">
<h1 class="hasAnchor">
<a href="#have-tweets-updated-regularly-with-cron" class="anchor"></a>Have tweets updated regularly with cron</h1>
<p>While in principle it is possible to have a constantly running docker container, with cron running inside it, it is more advisable (and more efficient) to let the host machine handle the cron part, and start up the relevant docker container, have it update tweets, and then stop immediately.</p>
<p>First, let’s run the docker container tasked with updating tweets in an interactive session to check again if everything is running smoothly.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="ex">docker</span> run --rm -v <span class="va">$HOME</span>/qf_data:/home/qf/qf_data giocomai/qf_get_tweets</a></code></pre></div>
<p>All good? What about having the host updating tweets every hour?</p>
<p>From the terminal on your host, run:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="ex">crontab</span> -e</a></code></pre></div>
<p>At the end of the document, add:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="ex">0</span> * * * * docker run --rm -v <span class="va">$HOME</span>/qf_data:/home/qf/qf_data giocomai/qf_get_tweets</a></code></pre></div>
<p>or, if you want to have a logfile for troubleshooting:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="ex">0</span> * * * * docker run --rm -v <span class="va">$HOME</span>/qf_data:/home/qf/qf_data giocomai/qf_get_tweets <span class="op">&gt;&gt;</span> <span class="va">$HOME</span>/qf_data/qf_get_tweets.log <span class="op">2&gt;&amp;1</span></a></code></pre></div>
<p>Leave an empty line at the end the crontab, save, and… you’re done. This will update tweets every time an hour starts (e.g. at 8.00, at 9.00, etc.).</p>
<p>If you are unfamiliar with cron, in order to customise frequency and time consider using <a href="https://github.com/bnosac/cronR"><code>cronR</code></a>.</p>
</div>
<div id="run-the-app" class="section level1">
<h1 class="hasAnchor">
<a href="#run-the-app" class="anchor"></a>Run the app</h1>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(quotefinder)</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">golem<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/golem/man/dockerfiles.html">add_dockerfile</a></span>()</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#getting-the-tweets">Getting the tweets</a></li>
      <li><a href="#dockerised-rstudio-with-pre-loaded-quotefinder">Dockerised Rstudio with pre-loaded <code>quotefinder</code></a></li>
      <li><a href="#have-tweets-updated-regularly-with-cron">Have tweets updated regularly with cron</a></li>
      <li><a href="#run-the-app">Run the app</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Giorgio Comai.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
